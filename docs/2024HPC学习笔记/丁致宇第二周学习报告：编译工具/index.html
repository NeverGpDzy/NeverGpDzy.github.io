<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-2024HPC学习笔记/丁致宇第二周学习报告：编译工具" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">丁致宇第二周学习报告：编译工具 | NeverGpDzy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="http://docs.nevergpdzy.cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="http://docs.nevergpdzy.cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="http://docs.nevergpdzy.cn/docs/2024HPC学习笔记/丁致宇第二周学习报告：编译工具"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="丁致宇第二周学习报告：编译工具 | NeverGpDzy"><meta data-rh="true" name="description" content="​	 						作者：丁致宇 时间：2024.1.27"><meta data-rh="true" property="og:description" content="​	 						作者：丁致宇 时间：2024.1.27"><link data-rh="true" rel="icon" href="http://picture.nevergpdzy.cn/img_for_Typora/OIG%20(3).png"><link data-rh="true" rel="canonical" href="http://docs.nevergpdzy.cn/docs/2024HPC学习笔记/丁致宇第二周学习报告：编译工具"><link data-rh="true" rel="alternate" href="http://docs.nevergpdzy.cn/docs/2024HPC学习笔记/丁致宇第二周学习报告：编译工具" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="http://docs.nevergpdzy.cn/docs/2024HPC学习笔记/丁致宇第二周学习报告：编译工具" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KMFW7K9OSU-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="NeverGpDzy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="NeverGpDzy Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="NeverGpDzy" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.27263fc6.css">
<script src="/assets/js/runtime~main.af93476d.js" defer="defer"></script>
<script src="/assets/js/main.f3e2a8f4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="http://picture.nevergpdzy.cn/img_for_Typora/OIG%20(3).png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="http://picture.nevergpdzy.cn/img_for_Typora/OIG%20(3).png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NeverGpDzy</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Total</a><a class="navbar__item navbar__link" href="/docs/SuperComputer/超算temp">超算</a><a class="navbar__item navbar__link" href="/docs/DataStructer/排序算法/TimSort">数据结构</a><a class="navbar__item navbar__link" href="/docs/Linux/intro">Linux</a><a class="navbar__item navbar__link" href="/docs/Python/Python基础运算">Python</a><a class="navbar__item navbar__link" href="/docs/Temp/文档网站部署教程">Temp</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about">关于</a><a href="https://nevergpdzy.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">主页<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Profile</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/2024hpc学习笔记">2024HPC学习笔记</a><button aria-label="折叠侧边栏分类 &#x27;2024HPC学习笔记&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2024HPC学习笔记/丁致宇第一周学习报告">丁致宇第一周学习报告</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2024HPC学习笔记/丁致宇第二周学习报告-《并行程序设计基础》2.4-2.6">丁致宇第二周学习报告-《并行程序设计基础》2.4-2.10</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2024HPC学习笔记/丁致宇第二周学习报告：编译工具">丁致宇第二周学习报告：编译工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2024HPC学习笔记/丁致宇第二周学习报告：深入中大型项目的Cmakelists">丁致宇第二周学习报告 深入中大型项目的Cmakelists</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2024HPC学习笔记/丁致宇第三周学习报告：MPI学习">丁致宇第三周学习报告：MPI学习</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2024HPC学习笔记/丁致宇第五周学习报告">丁致宇第五周学习报告</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2024HPC学习笔记/丁致宇寒假学习汇报">丁致宇寒假学习汇报</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2024HPC学习笔记/2022特招题：循环依赖">2022特招题：循环依赖</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/supercomputer">SuperComputer</a><button aria-label="展开侧边栏分类 &#x27;SuperComputer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/数据结构">数据结构</a><button aria-label="展开侧边栏分类 &#x27;数据结构&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/学校">学校</a><button aria-label="展开侧边栏分类 &#x27;学校&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/linux">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/python">Python</a><button aria-label="展开侧边栏分类 &#x27;Python&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/temp">Temp</a><button aria-label="展开侧边栏分类 &#x27;Temp&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/文档网站教学basics">文档网站教学Basics</a><button aria-label="展开侧边栏分类 &#x27;文档网站教学Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/文档网站教学extras">文档网站教学Extras</a><button aria-label="展开侧边栏分类 &#x27;文档网站教学Extras&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/2024hpc学习笔记"><span itemprop="name">2024HPC学习笔记</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">丁致宇第二周学习报告：编译工具</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>丁致宇第二周学习报告：编译工具</h1>
<p>​	 						作者：丁致宇 时间：2024.1.27</p>
<h1>目录</h1>
<p>[TOC]</p>
<h1>正文</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cmake学习">CMake学习<a href="#cmake学习" class="hash-link" aria-label="CMake学习的直接链接" title="CMake学习的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cmake简介">CMake简介<a href="#cmake简介" class="hash-link" aria-label="CMake简介的直接链接" title="CMake简介的直接链接">​</a></h3>
<ol>
<li>
<p><strong>什么是CMake？</strong>
CMake（英文 Cross platform Make 的缩写）它不是构建系统，而是构建系统生成器，属于一个跨平台构建工具，在 Linux 平台生成构建系统 make 的 Makefile 文件，在 Windows 平台生成 Visual Studio 或 MSVC 的 工程等。所以具体的构建工作还是需要交给例如 Make，Ninja，MSVC 等这些构建系统去执行。</p>
</li>
<li>
<p><strong>什么是CMakeLists.txt?</strong>
CMakeLists.txt 是 CMake 用来描述项目构建规则和过程的重要文件。它就像是一份构建指令清单，告诉 CMake 如何编译和链接代码。在 CMakeLists.txt 中，我们可以设置项目名称、指定需要编译的源文件、添加库文件依赖等等。CMake 会读取这个文件并生成对应的编译文件，指导整个构建过程。编写 CMakeLists.txt 可以让跨平台编译变得更加简单方便。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cmake基础语法">CMake基础语法<a href="#cmake基础语法" class="hash-link" aria-label="CMake基础语法的直接链接" title="CMake基础语法的直接链接">​</a></h3>
<p><strong>cmake_minimum_required</strong>
设置cmake的最低版本要求
示例：</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.22)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>project</strong>
可以用来指定工程的名字和支持的语言，默认支持所有语言
PROJECT（HELLO）指定了工程的名字，并且支持所有语言（大力推荐）
PROJECT（HELLO CXX）指定了工程的名字，并且支持的语言是c++
PROJECT（HELLO C CXX）指定了工程的名字，并且支持的语言是c和c++
示例：</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">project(Test)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>set关键字</strong>
用于设置变量的值。这个变量可以为普通变量，缓冲变量或者是环境变量。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SET(&lt;variable&gt; &lt;value&gt;... [PARENT_SCOPE]) #设置普通变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET(&lt;variable&gt; &lt;value&gt;... CACHE &lt;type&gt; &lt;docstring&gt; [FORCE]) #设置缓存变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET(ENV{&lt;variable&gt;} [&lt;value&gt;]) #设置环境变量</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>add_executable</strong>
生成一个可执行文件（executable，可执行的）</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ADD_EXECUTABLE(hello ${SRC_LIST})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在这行代码中，hello是生成可执行文件的文件名，文件的内容取的变量SRC_LIST的内容</p>
<p><strong>MESSAGE关键字</strong></p>
<p>向终端输出用户自定义的信息（个人感觉类似于c语言中printf()）</p>
<p>主要包含三种信息：</p>
<p>SEND_ERROR,产生错误，生成过程被跳过。</p>
<p>STATUS，输出前缀为-的信息。</p>
<p>FATAL_ERROR,立即终止所有cmake过程。</p>
<p><strong>举例：</strong>
<code>Message( STATUS &quot;module path = ${CMAKE_MODULE_PATH}&quot; )</code> 这段代码在CMake中用于输出一条状态信息到控制台。具体来说：</p>
<ul>
<li><code>Message</code> 是CMake的一个命令，它允许在构建过程中显示消息给用户。</li>
<li><code>STATUS</code> 参数指定了消息的类型，这里是“状态”信息，通常这类信息是告知性的，不会中断构建过程，但会在标准输出（stdout）或CMake GUI界面中显示。</li>
<li><code>&quot;module path = ${CMAKE_MODULE_PATH}&quot;</code> 是要显示的消息内容，其中 <code>${CMAKE_MODULE_PATH}</code> 是一个预定义的CMake变量，它包含了CMake查找模块文件时搜索路径的列表。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cmake实践">CMake实践<a href="#cmake实践" class="hash-link" aria-label="CMake实践的直接链接" title="CMake实践的直接链接">​</a></h3>
<p><strong>用cmake实现OpenMP、MPI、CUDA程序的编译</strong></p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.8 FATAL_ERROR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project(HelloPrograms LANGUAGES CXX CUDA)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 寻找OpenMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(OpenMP REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CUDA程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(hello_cuda hello_cuda.cu)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MPI程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(MPI REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include_directories(SYSTEM ${MPI_INCLUDE_PATH})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(hello_mpi hello_mpi.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(hello_mpi MPI::MPI_CXX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OpenMP程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(hello_omp hello_omp.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(hello_omp OpenMP::OpenMP_CXX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="makefile学习">makefile学习<a href="#makefile学习" class="hash-link" aria-label="makefile学习的直接链接" title="makefile学习的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile简介">makefile简介<a href="#makefile简介" class="hash-link" aria-label="makefile简介的直接链接" title="makefile简介的直接链接">​</a></h3>
<p><strong>Makefile</strong>是Linux和类Unix系统中用于自动化构建的工具<code>make</code>所使用的配置文件。它定义了如何编译和链接程序的目标文件（.o）、依赖关系以及命令规则。通过解析Makefile，<code>make</code>能够自动检测哪些源文件发生了变化，并执行相应的编译操作，避免了手动输入复杂的编译命令，极大地提高了开发效率。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile基础语法">makefile基础语法<a href="#makefile基础语法" class="hash-link" aria-label="makefile基础语法的直接链接" title="makefile基础语法的直接链接">​</a></h3>
<ol>
<li><strong>目标（Targets）</strong>：</li>
</ol>
<ul>
<li>目标通常对应于一个可执行文件或中间文件，如：<code>target: dependencies</code>。例如 <code>hello: hello.o</code> 表示  “hello”这个目标依赖于“hello.o”。</li>
</ul>
<ol start="2">
<li><strong>依赖（Dependencies）</strong>：</li>
</ol>
<ul>
<li>依赖文件是一系列在生成目标之前需要先存在的文件。当依赖文件比目标文件新或者目标不存在时，make会执行相关规则进行更新。</li>
</ul>
<ol start="3">
<li><strong>命令规则（Commands）</strong>：</li>
</ol>
<ul>
<li>命令行写在依赖关系之后，每行以制表符（tab键）开始。例如：<!-- -->
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">target: dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<!-- -->这里，<code>command1</code>和<code>command2</code>是在依赖文件发生改变后用来重建目标的命令。</li>
</ul>
<ol start="4">
<li><strong>变量（Variables）</strong>：</li>
</ol>
<ul>
<li>变量用于存储重复使用的值，例如编译器、编译 选项等。<!-- -->
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CC = gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CFLAGS = -Wall -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target: dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$(CC) $(CFLAGS) -c source.c -o target.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<ol start="5">
<li><strong>隐式规则与模式规则（Implicit Rules and Pattern Rules）</strong>：</li>
</ol>
<ul>
<li>Make自带了一些预定义的隐式规则，如<code>.c.o:</code>用于编译C源码文件到目标文件。</li>
<li>模式规则允许你用一种简练的方式来描述一组具有相同编译模式的文件。</li>
</ul>
<ol start="6">
<li><strong>清理目标（Clean Target）</strong>：</li>
</ol>
<ul>
<li>通常定义一个<code>clean</code>目标来清除所有生成的中间文件和最终目标文件，如：<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -f *.o target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile更多使用方法技巧">makefile更多使用方法、技巧<a href="#makefile更多使用方法技巧" class="hash-link" aria-label="makefile更多使用方法、技巧的直接链接" title="makefile更多使用方法、技巧的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="关于">关于$^<a href="#关于" class="hash-link" aria-label="关于$^的直接链接" title="关于$^的直接链接">​</a></h4>
<p>在 Makefile 中，<code>$^</code> 是一个自动变量，它代表了当前规则中所有的依赖项（prerequisites），也就是冒号 <code>:</code> 右边列出的所有项。这些依赖项被空格分隔，且不包括重复的依赖项。</p>
<p>例如，如果你有一个 Makefile 规则如下：</p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">myprogram: main.o utils.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gcc -o myprogram $^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里的 <code>$^</code> 将会被展开成 <code>main.o utils.o</code>。所以，上面的规则相当于：</p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">myprogram: main.o utils.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gcc -o myprogram main.o utils.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 <code>$^</code> 的好处是你不必手动重复所有的依赖项，这使得 Makefile 更加简洁和易于维护。如果依赖项列表发生变化，你只需要更新依赖项列表，而不是每个地方都要修改。</p>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常见的伪目标">常见的伪目标：<a href="#常见的伪目标" class="hash-link" aria-label="常见的伪目标：的直接链接" title="常见的伪目标：的直接链接">​</a></h4>
<p>需要在这些伪目标前添加 <code>.PHONY</code> 声明，以告诉 <code>make</code> 这些目标不是文件名：</p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY: all clean install uninstall distclean test help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>
<p><strong><code>all</code></strong>:
通常是默认目标，用来编译所有 的程序。如果你只输入 <code>make</code> 命令，通常 <code>all</code> 目标会被执行。</p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">all: prog1 prog2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong><code>clean</code></strong>:
如之前所述，用来删除所有由 make 创建的文件。</p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -f *.o prog1 prog2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong><code>check</code> 或 <code>test</code></strong>:
用来运行程序的测试套件。</p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test: all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./test_script.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p><strong>注意：</strong>
这里面除了all这个伪目标外都需要使用<code>make 目标名</code>来触发使用</p>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="在项目中存在多级文件夹结构时可以用以下的方法处理">在项目中存在多级文件夹结构时可以用以下的方法处理<a href="#在项目中存在多级文件夹结构时可以用以下的方法处理" class="hash-link" aria-label="在项目中存在多级文件夹结构时可以用以下的方法处理的直接链接" title="在项目中存在多级文件夹结构时可以用以下的方法处理的直接链接">​</a></h4>
<ol>
<li>
<p><strong>源文件路径</strong>：</p>
<ul>
<li>如果源文件位于不同子目录下，可以在依赖关系中明确写出完整路径。例如，如果<code>src/subdir1</code>目录下有<code>source1.c</code>，则可以这样编写规则：<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">target: src/subdir1/source1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $(CC) $(CFLAGS) -o target $^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>相对路径和绝对路径</strong>：</p>
<ul>
<li>在命令行中引用文件时，可以使用相对路径（相对于Makefile的位置）或绝对路径。如果目标文件和依赖文件不在同一目录下，可能需要调整输出目录或者编译命令中的 <code>-o</code> 参数来指定输出位置。</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile实践">makefile实践<a href="#makefile实践" class="hash-link" aria-label="makefile实践的直接链接" title="makefile实践的直接链接">​</a></h3>
<p><strong>用makefile实现OpenMP、MPI、CUDA程序的编译</strong></p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 变量定义</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CC=gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CXX=g++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NVCC=nvcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MPICC=mpicxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CFLAGS=-fopenmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认目标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all: hello_cuda hello_mpi hello_omp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CUDA程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello_cuda: hello_cuda.cu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(NVCC) -o hello_cuda hello_cuda.cu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MPI程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello_mpi: hello_mpi.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(MPICC) -o hello_mpi hello_mpi.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OpenMP程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello_omp: hello_omp.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) $(CFLAGS) -o hello_omp hello_omp.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 清理目标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY: clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm -f hello_cuda hello_mpi hello_omp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试生成的可执行文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./hello_omp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./hello_mpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./hello_cuda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile实践简化实践">makefile实践简化实践<a href="#makefile实践简化实践" class="hash-link" aria-label="makefile实践简化实践的直接链接" title="makefile实践简化实践的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="自动变量简化基本命令块">自动变量简化基本命令块<a href="#自动变量简化基本命令块" class="hash-link" aria-label="自动变量简化基本命令块的直接链接" title="自动变量简化基本命令块的直接链接">​</a></h4>
<p><strong>简化前</strong></p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">myprogram: main.o utils.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gcc -o myprogram main.o utils.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>简化后</strong></p>
<div class="language-make codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-make codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">myprogram: main.o utils.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gcc -o $@ $^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>自动变量<code>$@</code>表示目标文件（在这里是<code>myprogram</code>），<code>$^</code>表示所有的依赖文件（在这里是<code>main.o utils.o</code>）</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="每一个c文件都编译为可执行文件">每一个.c文件都编译为可执行文件<a href="#每一个c文件都编译为可执行文件" class="hash-link" aria-label="每一个.c文件都编译为可执行文件的直接链接" title="每一个.c文件都编译为可执行文件的直接链接">​</a></h4>
<p>如果您需要将文件夹中的每个<code>.c</code>文件单独编译成一个可执行文件，您可以在Makefile中使用模式规则来完成这个任务。以下是一个简化的Makefile示例，它会找到当前目录下所有的<code>.c</code>文件，并为每个文件编译生成一个同名的可执行文件（不包含<code>.c</code>扩展名）：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 定义编译器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CC := gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 定义编译选项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CFLAGS := -Wall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查找当前目录下所有的.c文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SOURCES := $(wildcard *.c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将.c文件列表转换成可执行文件列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXECUTABLES := $(SOURCES:.c=)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认目标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all: $(EXECUTABLES)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 模式规则：如何从.c文件生成可执行文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%: %.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $(CC) $(CFLAGS) -o $@ $&lt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 伪目标，比如清理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY: clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -f $(EXECUTABLES)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解释一下这个Makefile：</p>
<ol>
<li><code>CC</code>变量定义了使用的编译器，这里是<code>gcc</code>。</li>
<li><code>CFLAGS</code>变量定义了编译时使用的选项，这里使用<code>-Wall</code>打开所有警告。</li>
<li><code>SOURCES</code>变量使用<code>wildcard</code>函数获取当前目录下所有的<code>.c</code>文件。</li>
<li><code>EXECUTABLES</code>变量将<code>SOURCES</code>变量中的文件名后缀从<code>.c</code>改为无后缀，即可执行文件名。</li>
<li><code>all</code>是默认目标，它依赖于所有的可执行文件。</li>
<li><code>%: %.c</code>是一个模式规则，它告诉make如何从每个<code>.c</code>文件生成一个可执行文件。<code>$@</code>代表目标文件名，<code>$&lt;</code>代表第一个依赖项，即对应的<code>.c</code>文件。</li>
<li><code>.PHONY</code>定义了一个伪目标<code>clean</code>，以确保即使存在名为<code>clean</code>的文件，执行<code>make clean</code>也会执行清理命令，这里它会删除所有的可执行文件。</li>
</ol>
<p>使用这个Makefile，只需在命令行中运行<code>make</code>，它会自动为每个<code>.c</code>文件编译生成对应的可执行文件。运行<code>make clean</code>将会删除这些可执行文件。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile真实实践">Makefile真实实践<a href="#makefile真实实践" class="hash-link" aria-label="Makefile真实实践的直接链接" title="Makefile真实实践的直接链接">​</a></h3>
<p>详细解读一下下面这个makefile</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># We will benchmark you against Intel MKL implementation, the default processor vendor-tuned implementation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This makefile is intended for the Intel C compiler.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Your code must compile (with icc) with the given CFLAGS. You may experiment with the OPT variable to invoke additional compiler options.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CC = gcc </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OPT = -no-multibyte-chars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLAGS = -O3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -fopt-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LDLIBS = -lpthread -lm -llapack -lopenblas -lrt -lcblas -I/usr/include/openblas -lgptl -lpapi -O</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets = benchmark-test benchmark-naive benchmark-blocked benchmark-blas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objects = benchmark-test.o benchmark.o gemm-naive.o gemm-blocked.o gemm-blas.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY : default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default : all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY : all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all : clean $(targets)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-test : benchmark-test.o gemm-blocked.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-naive : benchmark.o gemm-naive.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS)  $(LDLIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-blocked : benchmark.o gemm-blocked.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-blas : benchmark.o gemm-blas.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%.o : %.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -c $(CFLAGS) $(FLAGS) $&lt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY : clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm -f $(targets) $(objects)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>分析</strong></p>
<p>这个Makefile是用来编译和链接一个基于矩阵乘法的基准测试程序的，可能有几个不同版本的矩阵乘法实现（例如朴素的、分块的和使用BLAS库的）。下面是对Makefile中各个部分的详细解读：</p>
<p>首先，Makefile中的注释说明了这个Makefile是为Intel C编译器设计的，但实际上在Makefile中指定的编译器是<code>gcc</code>。它还提到了可以通过修改<code>OPT</code>变量来尝试不同的编译器选项。</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CC = gcc </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OPT = -no-multibyte-chars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLAGS = -O3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -fopt-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LDLIBS = -lpthread -lm -llapack -lopenblas -lrt -lcblas -I/usr/include/openblas -lgptl -lpapi -O</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>CC</code>：指定编译器为gcc。</li>
<li><code>OPT</code>：这是一个注释掉的变量，可以用来添加额外的编译器选项，但在当前的Makefile中没有使用。</li>
<li><code>FLAGS</code>：指定编译器优化级别为<code>-O3</code>，这是编译器的一个常用优化选项，用于启用高级优化。</li>
<li><code>LDLIBS</code>：指定链接器选项，包括需要链接的库。这里包括了多线程库<code>pthread</code>、数学库<code>m</code>、LAPACK库、OpenBLAS库、实时库<code>rt</code>、CBLAS库、GPTL性能分析库和PAPI性能API库。<code>-I/usr/include/openblas</code>是一个编译器选项，用于指定OpenBLAS库的头文件位置。注意这里的<code>-O</code>可能是一个错误，因为它通常是一个编译器优化标志，而不是链接器标志。</li>
</ul>
<p>接下来，Makefile定义了目标和对象文件：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">targets = benchmark-test benchmark-naive benchmark-blocked benchmark-blas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objects = benchmark-test.o benchmark.o gemm-naive.o gemm-blocked.o gemm-blas.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>targets</code>：这些是Makefile要构建的最终可执行文件。</li>
<li><code>objects</code>：这些是编译源文件后生成的中间对象文件。</li>
</ul>
<p>Makefile中还有一些伪目标，这些目标不对应文件名，而是执行特定的命令：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY : default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default : all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY : all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all : clean $(targets)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>.PHONY</code>：这个声明告诉make这些目标不是文件名。</li>
<li><code>default</code>：这是默认目标，当你只输入<code>make</code>命令时执行的目标。这里它依赖于<code>all</code>目标。</li>
<li><code>all</code>：这个目标首先执行<code>clean</code>命令来删除所有的目标和对象文件，然后构建所有的<code>targets</code>。</li>
</ul>
<p>下面是具体的规则来构建每个目标：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-test : benchmark-test.o gemm-blocked.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-naive : benchmark.o gemm-naive.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-blocked : benchmark.o gemm-blocked.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-blas : benchmark.o gemm-blas.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里每个目标都有自己的依赖，然后使用<code>$(CC)</code>（gcc）来链接对象文件和库，生成最终的可执行文件。</p>
<p>对于每个<code>.c</code>文件的编译规则：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%.o : %.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -c $(CFLAGS) $(FLAGS) $&lt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>%</code>是一个通配符，这条规则告诉make如何从每个<code>.c</code>文件生成<code>.o</code>文件。这里<code>$&lt;</code>代表依赖列表中的第一个项，即对应的<code>.c</code>文件。</li>
</ul>
<p>最后，<code>clean</code>目标用于清理构建过程中生成的所有文件：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.PHONY : clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rm -f $(targets) $(objects)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个规则删除了所有的目标和对象文件，确保下一次构建是从干净的状态开始。</p>
<p>总结：这个Makefile定义了一系列规则来编译和链接基于不同矩阵乘法实现的基准测试程序。它使用了伪目标来组织构建过程，并提供了清理构建产物的功能。</p>
<p><strong>疑问</strong></p>
<p>在Makefile中，规则的顺序并不总是决定它们被执行的顺序。Makefile使用依赖关系来确定哪些规则需要首先执行。当你尝试构建一个目标时（比如一个可执行文件），<code>make</code>会查看这个目标的依赖（通常是一些对象文件），然后寻找如何构建这些依赖的规则。这意味着，即使编译生成<code>.o</code>文件的规则在Makefile的后面，只要有目标需要这些对象文件，<code>make</code>就会先执行相关的规则来生成它们。</p>
<p>在你提供的Makefile中，当我们尝试构建<code>benchmark-test</code>、<code>benchmark-naive</code>、<code>benchmark-blocked</code>或<code>benchmark-blas</code>这些目标时，<code>make</code>会寻找它们依赖的<code>.o</code>文件。例如：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">benchmark-test : benchmark-test.o gemm-blocked.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -o $@ $^ $(FLAGS) $(LDLIBS)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在尝试构建<code>benchmark-test</code>之前，<code>make</code>需要<code>benchmark-test.o</code>和<code>gemm-blocked.o</code>这两个对象文件。如果这些文件不存在或源文件比现有的对象文件更新，<code>make</code>会寻找如何构建这些对象文件的规则。在这个Makefile中，这个规则是：</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%.o : %.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(CC) -c $(CFLAGS) $(FLAGS) $&lt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这条规则告诉<code>make</code>如何从<code>.c</code>文件生成<code>.o</code>文件。<code>%</code>是一个模式匹配符，它会匹配任何目标和依赖之间共有的部分。这里，<code>$&lt;</code>表示所有依赖中的第一个，即对应的<code>.c</code>文件。</p>
<p>因此，即使这个规则在Makefile的最后，它仍然会在构建可执行文件之前先被执行，因为可执行文件的构建依赖于对象文件。这是<code>make</code>的一个基本特性：它会根据依赖关系和文件的时间戳来确定哪些规则需要被执行，而不是仅仅基于它们在Makefile中出现的顺序。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用sh脚本进行编译">使用sh脚本进行编译<a href="#使用sh脚本进行编译" class="hash-link" aria-label="使用sh脚本进行编译的直接链接" title="使用sh脚本进行编译的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="普通的sh脚本编译">普通的sh脚本编译<a href="#普通的sh脚本编译" class="hash-link" aria-label="普通的sh脚本编译的直接链接" title="普通的sh脚本编译的直接链接">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定源文件名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SOURCE=&quot;my_program.cpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定输出可执行文件名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXECUTABLE=&quot;my_program&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 使用mpicxx编译器（通常为OpenMPI或MPICH提供的MPI版本的C++编译器）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 同时添加OpenMP支持（-fopenmp），链接MPI库（-lmpi）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpicxx -o $EXECUTABLE $SOURCE -fopenmp -lmpi -std=c++11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查编译是否成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $? -eq 0 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Compilation successful.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Compilation failed.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果编译成功，可以运行程序（假设是并行执行）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># mpirun -np &lt;num_procs&gt; ./my_program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 其中&lt;num_procs&gt;是你想要使用的处理器核心数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="更高级的sh脚本编译">更高级的sh脚本编译<a href="#更高级的sh脚本编译" class="hash-link" aria-label="更高级的sh脚本编译的直接链接" title="更高级的sh脚本编译的直接链接">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the paths for MPI, OpenMP, and CUDA compilers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Please adjust these variables according to your environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MPI_COMPILER=mpicc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPENMP_COMPILER=gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CUDA_COMPILER=nvcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the source file names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MPI_SOURCE=&quot;your_mpi_program.c&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPENMP_SOURCE=&quot;your_openmp_program.c&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CUDA_SOURCE=&quot;your_cuda_program.cu&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the output names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MPI_OUTPUT=&quot;mpi_program&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPENMP_OUTPUT=&quot;openmp_program&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CUDA_OUTPUT=&quot;cuda_program&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Compile MPI program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Compiling MPI program...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$MPI_COMPILER $MPI_SOURCE -o $MPI_OUTPUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $? -eq 0 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;MPI program compiled successfully.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Error compiling MPI program.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Compile OpenMP program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Compiling OpenMP program...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$OPENMP_COMPILER -fopenmp $OPENMP_SOURCE -o $OPENMP_OUTPUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $? -eq 0 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;OpenMP program compiled successfully.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Error compiling OpenMP program.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Compile CUDA program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Compiling CUDA program...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$CUDA_COMPILER $CUDA_SOURCE -o $CUDA_OUTPUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $? -eq 0 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;CUDA program compiled successfully.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Error compiling CUDA program.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;All programs compiled successfully.&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>保存这个脚本为<code>compile.sh</code>，然后在终端中运行<code>chmod +x compile.sh</code>来给予执行权限。运行脚本前，请确保你已经正确设置了脚本中的编译器路径和源文件名。</p>
<p>这个shell脚本中，<code>$?</code>变量包含了上一条命令的退出状态。如果命令成功执行，它会返回0，否则返回非0值。脚本中的<code>if</code>语句会检查每个编译命令是否成功，如果有任何编译失败，脚本将打印错误信息并退出。</p>
<p>这个脚本假设源代码文件不需要任何额外的库或者特定的编译器选项。如果程序依赖于特定的库或者需要额外的编译选项，需要相应地修改编译命令。例如，如果CUDA程序需要链接到某些库，可能需要添加<code>-l</code>选项到<code>nvcc</code>命令中。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="类似makefile的编译脚本">类似makefile的编译脚本<a href="#类似makefile的编译脚本" class="hash-link" aria-label="类似makefile的编译脚本的直接链接" title="类似makefile的编译脚本的直接链接">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 变量定义</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CC=gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CXX=g++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NVCC=nvcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MPICC=mpicxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CFLAGS=-fopenmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认目标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function build_all {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_hello_cuda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_hello_mpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_hello_omp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CUDA程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function build_hello_cuda {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $NVCC -o hello_cuda hello_cuda.cu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MPI程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function build_hello_mpi {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $MPICC -o hello_mpi hello_mpi.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OpenMP程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function build_hello_omp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $CC $CFLAGS -o hello_omp hello_omp.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 清理目标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function clean {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -f hello_cuda hello_mpi hello_omp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试生成的可执行文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./hello_omp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./hello_mpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ./hello_cuda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解析命令行参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function main {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case &quot;$1&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clean)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        test)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            build_all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 调用主函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main $1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>给它执行权限：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x build.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过以下命令运行：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./build.sh         # 编译所有程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./build.sh clean   # 清理编译产生的文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./build.sh test    # 测试生成的可执行文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个脚本提供了与Makefile相同的功能，包括编译CUDA、MPI和OpenMP程序，清理编译产生的文件，以及测试编译出的程序。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/2024HPC学习笔记/丁致宇第二周学习报告-《并行程序设计基础》2.4-2.6"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">丁致宇第二周学习报告-《并行程序设计基础》2.4-2.10</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/2024HPC学习笔记/丁致宇第二周学习报告：深入中大型项目的Cmakelists"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">丁致宇第二周学习报告 深入中大型项目的Cmakelists</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cmake学习" class="table-of-contents__link toc-highlight">CMake学习</a><ul><li><a href="#cmake简介" class="table-of-contents__link toc-highlight">CMake简介</a></li><li><a href="#cmake基础语法" class="table-of-contents__link toc-highlight">CMake基础语法</a></li><li><a href="#cmake实践" class="table-of-contents__link toc-highlight">CMake实践</a></li></ul></li><li><a href="#makefile学习" class="table-of-contents__link toc-highlight">makefile学习</a><ul><li><a href="#makefile简介" class="table-of-contents__link toc-highlight">makefile简介</a></li><li><a href="#makefile基础语法" class="table-of-contents__link toc-highlight">makefile基础语法</a></li><li><a href="#makefile更多使用方法技巧" class="table-of-contents__link toc-highlight">makefile更多使用方法、技巧</a></li><li><a href="#makefile实践" class="table-of-contents__link toc-highlight">makefile实践</a></li><li><a href="#makefile实践简化实践" class="table-of-contents__link toc-highlight">makefile实践简化实践</a></li><li><a href="#makefile真实实践" class="table-of-contents__link toc-highlight">Makefile真实实践</a></li></ul></li><li><a href="#使用sh脚本进行编译" class="table-of-contents__link toc-highlight">使用sh脚本进行编译</a><ul><li><a href="#普通的sh脚本编译" class="table-of-contents__link toc-highlight">普通的sh脚本编译</a></li><li><a href="#更高级的sh脚本编译" class="table-of-contents__link toc-highlight">更高级的sh脚本编译</a></li><li><a href="#类似makefile的编译脚本" class="table-of-contents__link toc-highlight">类似makefile的编译脚本</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">简介</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Linux/intro">Linux</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Linux/intro">超算</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Linux/intro">Python</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 NeverGpDzy</div></div></div></footer></div>
</body>
</html>